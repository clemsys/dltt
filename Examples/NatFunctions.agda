{-# OPTIONS --safe #-}

module Examples.NatFunctions where

open import Prelude
open import Base
open import Lemmas
open import NatFunctions
open import Poly


private
  variable
    â„“ : Level



module _ {A : Type â„“} {B : A â†’ Type â„“} where
  pair : â—‡ âŠ© âŸ¨ x âˆ¶ A ï¼ âŸ© âŠ¸ âŸ¨ y âˆ¶ B x ï¼ âŸ© âŠ¸ Î£ A B ï¼
  pair = ğ›Œ x â†¦ ğ›Œ y ï¼â†¦ (x , y) â± by lax, âˆ˜ id (Î¹ x) âŠ—á¶  id (Î¹ y) âˆ˜ id (Î¹ x) âŠ—á¶  unitr (Î¹ y) âˆ˜
                                     (id (Î¹ x) âŠ—á¶  (id (Î¹ y) âŠ—á¶  id â—‡ âˆ˜ unitl (Î¹ y âŠ— â—‡)) âˆ˜
                                      unitl (Î¹ x âŠ— â—‡ âŠ— Î¹ y âŠ— â—‡)
                                      âˆ˜
                                      (id â—‡ âŠ—á¶ 
                                       (id (Î¹ x) âŠ—á¶  id â—‡ âŠ—á¶  id (Î¹ y) âŠ—á¶  id â—‡ âˆ˜ assoc' (Î¹ x) â—‡ (Î¹ y âŠ— â—‡))
                                       âˆ˜ assoc' â—‡ (Î¹ x âŠ— â—‡) (Î¹ y âŠ— â—‡)))


module _ {A : Type â„“} where
  copyJ : (x : A) â†’ Î¹ x ^ 2 âŠ© A Ã— A ï¼
  copyJ x = (x , x) â±
    by lax, âˆ˜ id (Î¹ x) âŠ—á¶  id (Î¹ x) âˆ˜ id (Î¹ x) âŠ—á¶  unitr (Î¹ x) âˆ˜ id (Î¹ x) âŠ—á¶  id (Î¹ x) âŠ—á¶  id â—‡


module _ {A : Type â„“} where
  copy : â—‡ âŠ© âŸ¨ A ï¼ âŸ©^ 2 âŠ¸ A Ã— A ï¼
  copy = ğ›Œ x â†¦ (x , x) â±
    by lax, âˆ˜ id (Î¹ x) âŠ—á¶  id (Î¹ x) âˆ˜ id (Î¹ x) âŠ—á¶  unitr (Î¹ x) âˆ˜
        (id (Î¹ x) âŠ—á¶  id (Î¹ x) âŠ—á¶  id â—‡ âˆ˜ unitl (Î¹ x âŠ— Î¹ x âŠ— â—‡))

module _ {A B : Type â„“} where
  intersperse : â—‡ âŠ© âŸ¨ x âˆ¶ A ï¼ âŸ©^ 2 âŠ¸ âŸ¨ y âˆ¶ B ï¼ âŸ© âŠ¸ A Ã— B Ã— A ï¼
  intersperse = ğ›Œ x â†¦ ğ›Œ y â†¦ (x , y , x) â± by lax, âˆ˜ id (Î¹ x) âŠ—á¶  (lax, âˆ˜ id (Î¹ y) âŠ—á¶  id (Î¹ x)) âˆ˜
                                              (id (Î¹ x) âŠ—á¶  id (Î¹ y) âŠ—á¶  unitr (Î¹ x) âˆ˜
                                               (id (Î¹ x) âŠ—á¶ 
                                                (assoc' (Î¹ y) (Î¹ x) â—‡ âˆ˜ swap (Î¹ x) (Î¹ y) âŠ—á¶  id â—‡ âˆ˜
                                                 assoc (Î¹ x) (Î¹ y) â—‡)
                                                âˆ˜ id (Î¹ x âŠ— Î¹ x âŠ— Î¹ y âŠ— â—‡)))
                                              âˆ˜
                                              (id (Î¹ x âŠ— Î¹ x âŠ— Î¹ y âŠ— â—‡) âˆ˜
                                               (id (Î¹ x) âŠ—á¶  id (Î¹ x) âŠ—á¶  (id (Î¹ y) âŠ—á¶  id â—‡ âˆ˜ unitl (Î¹ y âŠ— â—‡)) âˆ˜
                                                unitl (Î¹ x âŠ— Î¹ x âŠ— â—‡ âŠ— Î¹ y âŠ— â—‡))
                                               âˆ˜
                                               (id â—‡ âŠ—á¶ 
                                                (id (Î¹ x) âŠ—á¶ 
                                                 (id (Î¹ x) âŠ—á¶  id â—‡ âŠ—á¶  id (Î¹ y) âŠ—á¶  id â—‡ âˆ˜ assoc' (Î¹ x) â—‡ (Î¹ y âŠ— â—‡))
                                                 âˆ˜ assoc' (Î¹ x) (Î¹ x âŠ— â—‡) (Î¹ y âŠ— â—‡))
                                                âˆ˜ assoc' â—‡ (Î¹ x âŠ— Î¹ x âŠ— â—‡) (Î¹ y âŠ— â—‡)))

module _ {A  : Type â„“} where

  copytwice : â—‡ âŠ© âŸ¨ x âˆ¶ A ï¼ âŸ©^ 4 âŠ¸ (A Ã— A) Ã— (A Ã— A) ï¼
  copytwice = ğ›Œ x â†¦ copy â‰º 2 ï¹«ï¼ (copy â‰º 2 ï¹« x â±)
    by id â—‡ âŠ—á¶ 
        (assoc â—‡ (Î¹ x âŠ— Î¹ x âŠ— â—‡) ((â—‡ âŠ— Î¹ x âŠ— Î¹ x âŠ— â—‡) âŠ— â—‡) âˆ˜
         id â—‡ âŠ—á¶ 
         (assoc (Î¹ x) (Î¹ x âŠ— â—‡) ((â—‡ âŠ— Î¹ x âŠ— Î¹ x âŠ— â—‡) âŠ— â—‡) âˆ˜
          id (Î¹ x) âŠ—á¶ 
          (assoc (Î¹ x) â—‡ ((â—‡ âŠ— Î¹ x âŠ— Î¹ x âŠ— â—‡) âŠ— â—‡) âˆ˜
           id (Î¹ x) âŠ—á¶ 
           id â—‡ âŠ—á¶ 
           (assoc â—‡ (Î¹ x âŠ— Î¹ x âŠ— â—‡) â—‡ âˆ˜
            id â—‡ âŠ—á¶ 
            (assoc (Î¹ x) (Î¹ x âŠ— â—‡) â—‡ âˆ˜
             id (Î¹ x) âŠ—á¶  (assoc (Î¹ x) â—‡ â—‡ âˆ˜ id (Î¹ x) âŠ—á¶  id â—‡ âŠ—á¶  id â—‡))))))
        âˆ˜
        (unitl' (â—‡ âŠ— Î¹ x âŠ— Î¹ x âŠ— â—‡ âŠ— â—‡ âŠ— Î¹ x âŠ— Î¹ x âŠ— â—‡ âŠ— â—‡) âˆ˜
         (unitl' (Î¹ x âŠ— Î¹ x âŠ— â—‡ âŠ— â—‡ âŠ— Î¹ x âŠ— Î¹ x âŠ— â—‡ âŠ— â—‡) âˆ˜
          id (Î¹ x) âŠ—á¶ 
          id (Î¹ x) âŠ—á¶ 
          (unitl' (â—‡ âŠ— Î¹ x âŠ— Î¹ x âŠ— â—‡ âŠ— â—‡) âˆ˜
           (unitl' (Î¹ x âŠ— Î¹ x âŠ— â—‡ âŠ— â—‡) âˆ˜
            id (Î¹ x) âŠ—á¶  id (Î¹ x) âŠ—á¶  (unitl' â—‡ âˆ˜ id â—‡)))))
        âˆ˜
        (id (Î¹ x) âŠ—á¶  id (Î¹ x) âŠ—á¶  id (Î¹ x) âŠ—á¶  id (Î¹ x) âŠ—á¶  id â—‡ âˆ˜
         unitl (Î¹ x âŠ— Î¹ x âŠ— Î¹ x âŠ— Î¹ x âŠ— â—‡))


module _ {A : Type â„“} {B : A â†’ Type â„“} {C : (x : A) â†’ B x â†’ Type â„“} where
  compose : â—‡ âŠ© âŸ¨ g âˆ¶ âŸ¨ x âˆ¶ A ï¼ âŸ©^ 0 âŠ¸ âŸ¨ y âˆ¶ B x ï¼ âŸ© âŠ¸ C x y ï¼ âŸ© âŠ¸ âŸ¨ f âˆ¶ âŸ¨ x âˆ¶ A ï¼ âŸ© âŠ¸ B x ï¼ âŸ©
    âŠ¸ âŸ¨ x âˆ¶ A ï¼ âŸ© âŠ¸ C x (f x) ï¼
  compose = ğ›Œ g â†¦ğ•— ğ›Œ f â†¦ğ•— ğ›Œ x ï¼â†¦  (g áµ€ â‰º 0 ï¹« x â±) ï¹«ï¼ (f áµ€ ï¹«ï¼ x â±)
    by assoc
        (Î› A
         (Î» xâ‚ â†’
            [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ]))
        â—‡ ((Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ]) âŠ— Î¹ x âŠ— â—‡) âŠ— â—‡)
        âˆ˜
        id
        (Î› A
         (Î» xâ‚ â†’
            [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ]))
        âŠ—á¶ 
        id â—‡ âŠ—á¶ 
        (assoc (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ])) (Î¹ x âŠ— â—‡) â—‡ âˆ˜
         id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ])) âŠ—á¶ 
         (assoc (Î¹ x) â—‡ â—‡ âˆ˜ id (Î¹ x) âŠ—á¶  id â—‡ âŠ—á¶  id â—‡))
        âˆ˜
        id
        (Î› A
         (Î» xâ‚ â†’
            [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ]))
        âŠ—á¶ 
        (unitl' (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ]) âŠ— Î¹ x âŠ— â—‡ âŠ— â—‡)
         âˆ˜
         id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ])) âŠ—á¶ 
         id (Î¹ x) âŠ—á¶  (unitl' â—‡ âˆ˜ id â—‡))
        âˆ˜
        (id
         (Î› A
          (Î» xâ‚ â†’
             [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ]))
         âŠ—á¶ 
         (id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ])) âŠ—á¶ 
          (id (Î¹ x) âŠ—á¶  id â—‡ âˆ˜ unitl (Î¹ x âŠ— â—‡))
          âˆ˜ unitl (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ]) âŠ— â—‡ âŠ— Î¹ x âŠ— â—‡))
         âˆ˜
         unitl
         (Î› A
          (Î» xâ‚ â†’ [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ])
          âŠ— â—‡ âŠ— Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ]) âŠ— â—‡ âŠ— Î¹ x âŠ— â—‡)
         âˆ˜
         (id â—‡ âŠ—á¶ 
          (id
           (Î› A
            (Î» xâ‚ â†’
               [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ]))
           âŠ—á¶ 
           id â—‡ âŠ—á¶ 
           (id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ])) âŠ—á¶ 
            id â—‡ âŠ—á¶  id (Î¹ x) âŠ—á¶  id â—‡
            âˆ˜ assoc' (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ])) â—‡ (Î¹ x âŠ— â—‡))
           âˆ˜
           assoc'
           (Î› A
            (Î» xâ‚ â†’
               [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ]))
           â—‡ ((Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ]) âŠ— â—‡) âŠ— Î¹ x âŠ— â—‡))
          âˆ˜
          assoc' â—‡
          (Î› A
           (Î» xâ‚ â†’ [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ])
           âŠ— â—‡)
          ((Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ]) âŠ— â—‡) âŠ— Î¹ x âŠ— â—‡)
          âˆ˜
          assoc'
          (â—‡ âŠ—
           Î› A
           (Î» xâ‚ â†’ [ â—‡ , Î› (B xâ‚) (Î» xâ‚‚ â†’ [ Î¹ xâ‚‚ âŠ— â—‡ , Î¹ (g .term xâ‚ xâ‚‚) ]) ])
           âŠ— â—‡)
          (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (f .term xâ‚) ]) âŠ— â—‡) (Î¹ x âŠ— â—‡)))


module _ {A : Type â„“} {B : A â†’ Type â„“} {C : (x : A) â†’ B x â†’ Type â„“} {m n : â„•} where
  compose' : â—‡ âŠ© âŸ¨ g âˆ¶ âŸ¨ x âˆ¶ A ï¼ âŸ©^ 0 âŠ¸ âŸ¨ y âˆ¶ B x ï¼ âŸ©^ m âŠ¸ C x y ï¼ âŸ© âŠ¸
    âŸ¨ f âˆ¶ âŸ¨ x âˆ¶ A ï¼ âŸ©^ n âŠ¸ B x ï¼ âŸ©^ m âŠ¸ âŸ¨ x âˆ¶ A ï¼ âŸ©^ (m * n) âŠ¸ C x (f x) ï¼
  compose' = ğ›Œ g â†¦ğ•— ğ›Œ f â†¦ğ•— ğ›Œ x ï¼â†¦ (g áµ€ â‰º 0 ï¹« x â±) â‰º m ï¹«ï¼ (f áµ€ â‰º n ï¹« x â±)
    by unitl _ âŠ—á¶  (âŠ—^-distr m n) âˆ˜ assoc' _ _ _



module _ {A : Type â„“} where
  ifthenelse : â—‡ âŠ© âŸ¨ b âˆ¶ Bool ï¼ âŸ©^ 0 âŠ¸ âŸ¨ A ï¼ âŸ©^ âˆ£ b âˆ£  âŠ¸ âŸ¨ A ï¼ âŸ©^ âˆ£ Â¬ b âˆ£ âŠ¸ A ï¼
  ifthenelse = ğ›Œ b ï¼â†¦ case b of
    (Î» b â†’ â—‡ âŠ— â—‡ âŠ© âŸ¨ A ï¼ âŸ©^ âˆ£ b âˆ£  âŠ¸ âŸ¨ A ï¼ âŸ©^ âˆ£ Â¬ b âˆ£ âŠ¸ A ï¼) type Î» where
      true â†’ ğ›Œ x ï¼â†¦ ğ›Œ _ ï¼â†¦ x â±
        by unitr (Î¹ x) âˆ˜
            (id (Î¹ x) âŠ—á¶  (id â—‡ âˆ˜ unitl â—‡) âˆ˜ unitl (Î¹ x âŠ— â—‡ âŠ— â—‡) âˆ˜
             unitl (â—‡ âŠ— Î¹ x âŠ— â—‡ âŠ— â—‡)
             âˆ˜
             (id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  (id (Î¹ x) âŠ—á¶  id â—‡ âŠ—á¶  id â—‡ âˆ˜ assoc' (Î¹ x) â—‡ â—‡) âˆ˜
              assoc' â—‡ â—‡ ((Î¹ x âŠ— â—‡) âŠ— â—‡)
              âˆ˜ assoc' (â—‡ âŠ— â—‡) (Î¹ x âŠ— â—‡) â—‡))
      false â†’ ğ›Œ _ ï¼â†¦ ğ›Œ y ï¼â†¦ y â±
        by unitr (Î¹ y) âˆ˜
            (id (Î¹ y) âŠ—á¶  id â—‡ âˆ˜ unitl (Î¹ y âŠ— â—‡) âˆ˜ unitl (â—‡ âŠ— Î¹ y âŠ— â—‡) âˆ˜
             unitl (â—‡ âŠ— â—‡ âŠ— Î¹ y âŠ— â—‡)
             âˆ˜
             (id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  id (Î¹ y) âŠ—á¶  id â—‡ âˆ˜
              assoc' â—‡ â—‡ (â—‡ âŠ— Î¹ y âŠ— â—‡)
              âˆ˜ assoc' (â—‡ âŠ— â—‡) â—‡ (Î¹ y âŠ— â—‡)))





module _ {A : LType â„“} where
  ite' : â—‡ âŠ© âŸ¨ b âˆ¶ Bool ï¼ âŸ©^ 0 âŠ¸ âŸ¨ A âŸ©^ âˆ£ b âˆ£  âŠ¸ âŸ¨ A âŸ©^ âˆ£ Â¬ b âˆ£ âŠ¸ A
  ite' = ğ›Œ b ï¼â†¦ case b of
    (Î» b â†’ â—‡ âŠ— â—‡ âŠ© âŸ¨ A âŸ©^ âˆ£ b âˆ£  âŠ¸ âŸ¨ A âŸ©^ âˆ£ Â¬ b âˆ£ âŠ¸ A) type Î» where
      true â†’ ğ›Œ x â†¦ğ•— ğ›Œ _ ï¼â†¦ x áµ€ by unitr (A .snd (x .term)) âˆ˜
                                    (id (A .snd (x .term)) âŠ—á¶  (id â—‡ âˆ˜ unitl â—‡) âˆ˜
                                     unitl (A .snd (x .term) âŠ— â—‡ âŠ— â—‡)
                                     âˆ˜ unitl (â—‡ âŠ— A .snd (x .term) âŠ— â—‡ âŠ— â—‡)
                                     âˆ˜
                                     (id â—‡ âŠ—á¶ 
                                      id â—‡ âŠ—á¶ 
                                      (id (A .snd (x .term)) âŠ—á¶  id â—‡ âŠ—á¶  id â—‡ âˆ˜
                                       assoc' (A .snd (x .term)) â—‡ â—‡)
                                      âˆ˜ assoc' â—‡ â—‡ ((A .snd (x .term) âŠ— â—‡) âŠ— â—‡)
                                      âˆ˜ assoc' (â—‡ âŠ— â—‡) (A .snd (x .term) âŠ— â—‡) â—‡))
      false â†’ ğ›Œ _ ï¼â†¦ ğ›Œ y â†¦ğ•— y áµ€ by unitr (A .snd (y .term)) âˆ˜
                                     (id (A .snd (y .term)) âŠ—á¶  id â—‡ âˆ˜ unitl (A .snd (y .term) âŠ— â—‡) âˆ˜
                                      unitl (â—‡ âŠ— A .snd (y .term) âŠ— â—‡)
                                      âˆ˜ unitl (â—‡ âŠ— â—‡ âŠ— A .snd (y .term) âŠ— â—‡)
                                      âˆ˜
                                      (id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  id (A .snd (y .term)) âŠ—á¶  id â—‡ âˆ˜
                                       assoc' â—‡ â—‡ (â—‡ âŠ— A .snd (y .term) âŠ— â—‡)
                                       âˆ˜ assoc' (â—‡ âŠ— â—‡) â—‡ (A .snd (y .term) âŠ— â—‡)))


module Ignore {A B : Type â„“} where
  foldMaybe : â—‡ âŠ© âŸ¨ z âˆ¶ Maybe A ï¼ âŸ© âŠ¸ âŸ¨ j âˆ¶ âŸ¨ A ï¼ âŸ© âŠ¸ B ï¼ âŸ©^ âˆ£ isJust z âˆ£ âŠ¸ âŸ¨ n âˆ¶ B ï¼ âŸ©^ âˆ£ isNothing z âˆ£ âŠ¸ B ï¼
  foldMaybe = ğ›Œ z ï¼â†¦ case z of
    (Î» z â†’ â—‡ âŠ— Î¹ z ^ 1 âŠ© âŸ¨ âŸ¨ A ï¼ âŸ© âŠ¸ B ï¼ âŸ©^ âˆ£ isJust z âˆ£ âŠ¸ âŸ¨ B ï¼ âŸ©^ âˆ£ isNothing z âˆ£ âŠ¸ B ï¼) type Î» where
      (just x) â†’ ğ›Œ j â†¦ğ•— ğ›Œ _ ï¼â†¦ j áµ€ ï¹«ï¼ x â± by assoc' (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) (Î¹ x) â—‡ âˆ˜
                                                 swap (Î¹ x) (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) âŠ—á¶  id â—‡
                                                 âˆ˜ assoc (Î¹ x) (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) â—‡
                                                 âˆ˜ id (Î¹ x âŠ— Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡)
                                                 âˆ˜
                                                 (id (Î¹ x âŠ— Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡) âˆ˜
                                                  (id (Î¹ x) âŠ—á¶ 
                                                   (id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) âŠ—á¶ 
                                                    (id â—‡ âˆ˜ unitl â—‡)
                                                    âˆ˜ unitl (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡ âŠ— â—‡))
                                                   âˆ˜
                                                   unitl
                                                   (Î¹ x âŠ— â—‡ âŠ— Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡ âŠ— â—‡))
                                                  âˆ˜
                                                  (id â—‡ âŠ—á¶ 
                                                   (id (Î¹ x) âŠ—á¶ 
                                                    id â—‡ âŠ—á¶ 
                                                    (id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) âŠ—á¶  id â—‡ âŠ—á¶  id â—‡ âˆ˜
                                                     assoc' (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) â—‡ â—‡)
                                                    âˆ˜
                                                    assoc' (Î¹ x) â—‡
                                                    ((Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡) âŠ— â—‡))
                                                   âˆ˜
                                                   assoc' â—‡ (Î¹ x âŠ— â—‡)
                                                   ((Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡) âŠ— â—‡)
                                                   âˆ˜
                                                   assoc' (â—‡ âŠ— Î¹ x âŠ— â—‡)
                                                   (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡) â—‡)
                                                  âˆ˜
                                                  ((id â—‡ âŠ—á¶  (id (Î¹ x) âˆ˜ oplinl) âŠ—á¶  id â—‡) âŠ—á¶ 
                                                   id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) âŠ—á¶  id â—‡)
                                                  âŠ—á¶  id â—‡)
      nothing â†’ ğ›Œ _ ï¼â†¦ ğ›Œ n ï¼â†¦ n â± by unitr (Î¹ n) âˆ˜
                                        (id (Î¹ n) âŠ—á¶  id â—‡ âˆ˜ unitl (Î¹ n âŠ— â—‡) âˆ˜ unitl (â—‡ âŠ— Î¹ n âŠ— â—‡) âˆ˜
                                         unitl (â—‡ âŠ— â—‡ âŠ— Î¹ n âŠ— â—‡)
                                         âˆ˜ unitl (â—‡ âŠ— â—‡ âŠ— â—‡ âŠ— Î¹ n âŠ— â—‡)
                                         âˆ˜
                                         (id â—‡ âŠ—á¶ 
                                          (id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  id (Î¹ n) âŠ—á¶  id â—‡ âˆ˜
                                           assoc' â—‡ â—‡ (â—‡ âŠ— Î¹ n âŠ— â—‡))
                                          âˆ˜ assoc' â—‡ (â—‡ âŠ— â—‡) (â—‡ âŠ— Î¹ n âŠ— â—‡)
                                          âˆ˜ assoc' (â—‡ âŠ— â—‡ âŠ— â—‡) â—‡ (Î¹ n âŠ— â—‡))
                                         âˆ˜ ((id â—‡ âŠ—á¶  (opltt âˆ˜ oplinr) âŠ—á¶  id â—‡) âŠ—á¶  id â—‡) âŠ—á¶  id (Î¹ n) âŠ—á¶  id â—‡)



module _ {A B : Type â„“} where
  foldMaybe : â—‡ âŠ© âŸ¨ z âˆ¶ Maybe A ï¼ âŸ© âŠ¸ âŸ¨ âŸ¨ A ï¼ âŸ© âŠ¸ B ï¼ âŸ©^ âˆ£ isJust z âˆ£ âŠ¸ âŸ¨ B ï¼ âŸ©^ âˆ£ isNothing z âˆ£ âŠ¸ B ï¼
  foldMaybe = ğ›Œ z ï¼â†¦ case z of
    (Î» z â†’ â—‡ âŠ— Î¹ z ^ 1 âŠ© âŸ¨ âŸ¨ A ï¼ âŸ© âŠ¸ B ï¼ âŸ©^ âˆ£ isJust z âˆ£ âŠ¸ âŸ¨ B ï¼ âŸ©^ âˆ£ isNothing z âˆ£ âŠ¸ B ï¼) type Î» where
      (just x) â†’ ğ›Œ j â†¦ğ•— ğ›Œ _ ï¼â†¦ j áµ€ ï¹«ï¼ x â±
        by assoc' (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) (Î¹ x) â—‡ âˆ˜
            swap (Î¹ x) (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) âŠ—á¶  id â—‡
            âˆ˜ assoc (Î¹ x) (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) â—‡
            âˆ˜ id (Î¹ x âŠ— Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡)
            âˆ˜
            (id (Î¹ x âŠ— Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡) âˆ˜
             (id (Î¹ x) âŠ—á¶ 
              (id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) âŠ—á¶ 
               (id â—‡ âˆ˜ unitl â—‡)
               âˆ˜ unitl (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡ âŠ— â—‡))
              âˆ˜
              unitl
              (Î¹ x âŠ— â—‡ âŠ— Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡ âŠ— â—‡))
             âˆ˜
             (id â—‡ âŠ—á¶ 
              (id (Î¹ x) âŠ—á¶ 
               id â—‡ âŠ—á¶ 
               (id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) âŠ—á¶  id â—‡ âŠ—á¶  id â—‡ âˆ˜
                assoc' (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) â—‡ â—‡)
               âˆ˜
               assoc' (Î¹ x) â—‡
               ((Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡) âŠ— â—‡))
              âˆ˜
              assoc' â—‡ (Î¹ x âŠ— â—‡)
              ((Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡) âŠ— â—‡)
              âˆ˜
              assoc' (â—‡ âŠ— Î¹ x âŠ— â—‡)
              (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ]) âŠ— â—‡) â—‡)
             âˆ˜
             ((id â—‡ âŠ—á¶  (id (Î¹ x) âˆ˜ oplinl) âŠ—á¶  id â—‡) âŠ—á¶ 
              id (Î› A (Î» xâ‚ â†’ [ Î¹ xâ‚ âŠ— â—‡ , Î¹ (j .term xâ‚) ])) âŠ—á¶  id â—‡)
             âŠ—á¶  id â—‡)
      nothing â†’ ğ›Œ _ ï¼â†¦ ğ›Œ n ï¼â†¦ n â±
        by unitr (Î¹ n) âˆ˜
            (id (Î¹ n) âŠ—á¶  id â—‡ âˆ˜ unitl (Î¹ n âŠ— â—‡) âˆ˜ unitl (â—‡ âŠ— Î¹ n âŠ— â—‡) âˆ˜
             unitl (â—‡ âŠ— â—‡ âŠ— Î¹ n âŠ— â—‡)
             âˆ˜ unitl (â—‡ âŠ— â—‡ âŠ— â—‡ âŠ— Î¹ n âŠ— â—‡)
             âˆ˜
             (id â—‡ âŠ—á¶ 
              (id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  id â—‡ âŠ—á¶  id (Î¹ n) âŠ—á¶  id â—‡ âˆ˜
               assoc' â—‡ â—‡ (â—‡ âŠ— Î¹ n âŠ— â—‡))
              âˆ˜ assoc' â—‡ (â—‡ âŠ— â—‡) (â—‡ âŠ— Î¹ n âŠ— â—‡)
              âˆ˜ assoc' (â—‡ âŠ— â—‡ âŠ— â—‡) â—‡ (Î¹ n âŠ— â—‡))
             âˆ˜ ((id â—‡ âŠ—á¶  (opltt âˆ˜ oplinr) âŠ—á¶  id â—‡) âŠ—á¶  id â—‡) âŠ—á¶  id (Î¹ n) âŠ—á¶  id â—‡)



